<!DOCTYPE html>
<html lang="fa-IR" dir="rtl">
  <head>
    <!-- META DATA -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- FAVICON -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/assets/images/brand/favicon.ico"
    />

    <!-- TITLE -->
    <title>بازنشانی رمز عبور</title>

    <!-- BOOTSTRAP CSS -->
    <link
      id="style"
      href="/assets/plugins/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- STYLE CSS -->
    <link href="/assets/css/style.css" rel="stylesheet" />
    <link href="/assets/css/dark-style.css" rel="stylesheet" />
    <link href="/assets/css/transparent-style.css" rel="stylesheet" />
    <link href="/assets/css/skin-modes.css" rel="stylesheet" />

    <!--- FONT-ICONS CSS -->
    <link href="/assets/css/icons.css" rel="stylesheet" />
    <link href="/css/toastify.min.css" rel="stylesheet" />

    <!-- COLOR SKIN CSS -->
    <link
      id="theme"
      rel="stylesheet"
      type="text/css"
      media="all"
      href="/assets/colors/color1.css"
    />
    <link href="/assets/switcher/css/switcher.css" rel="stylesheet" />
    <link href="/assets/switcher/demo.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      id="fonts"
      href="/assets/fonts/styles-fa-num/iran-yekan.css"
    />
    <link href="/assets/css/rtl.css" rel="stylesheet" />
  </head>

  <body class="app sidebar-mini rtl login-img">
    <!-- BACKGROUND-IMAGE -->
    <div class="">
      <!-- GLOABAL LOADER -->
      <div id="global-loader">
        <img src="/assets/images/loader.svg" class="loader-img" alt="Loader" />
      </div>
      <!-- End GLOABAL LOADER -->

      <!-- PAGE -->
      <div class="page">
        <div class="">
          <!-- CONTAINER OPEN -->
          <div class="col col-login mx-auto">
            <div class="text-center">
              <img
                src="/assets/images/brand/logo-white.png"
                class="header-brand-img m-0"
                alt=""
              />
            </div>
          </div>

          <!-- CONTAINER OPEN -->
          <div class="container-login100">
            <div class="wrap-login100 p-6">
              <form class="login100-form validate-form">
                <span class="login100-form-title pb-5">
                  بازنشانی گذرواژه
                </span>
                <p class="text-muted">
                  آدرس ایمیل ثبت شده در حساب خود را وارد کنید
                </p>
                <div
                  class="wrap-input100 validate-input input-group"
                  data-bs-validate="ایمیل معتبر لازم است: ex@abc.xyz"
                >
                  <a
                    href="javascript:void(0)"
                    class="input-group-text bg-white text-muted"
                  >
                    <i class="zmdi zmdi-email" aria-hidden="true"></i>
                  </a>
                  <input
                    class="input100 border-start-0 ms-0 form-control"
                    id="forgetEmail"
                    type="email"
                    placeholder="ایمیل"
                  />
                </div>
                <div
                  class="wrap-input100 validate-input input-group"
                >
                  <a
                    href="javascript:void(0)"
                    class="input-group-text bg-white text-muted"
                  >
                    <i class="zmdi zmdi-key" aria-hidden="true"></i>
                  </a>
                  <input
                    class="input100 border-start-0 ms-0 form-control"
                    id="password"
                    type="email"
                    placeholder="گذرواژه جدید"
                  />
                </div>
                <div
                  class="wrap-input100 validate-input input-group"
                >
                  <a
                    href="javascript:void(0)"
                    class="input-group-text bg-white text-muted"
                  >
                    <i class="zmdi zmdi-key" aria-hidden="true"></i>
                  </a>
                  <input
                    class="input100 border-start-0 ms-0 form-control"
                    id="rePassword"
                    type="email"
                    placeholder="تکرار گذرواژه"
                  />
                </div>
                <div class="submit">
                  <button class="btn btn-primary w-100" id="resetPassword">
                    <span
                      class="spinner-grow spinner-grow-sm visually-hidden"
                      role="status"
                      aria-hidden="true"
                    ></span>
                    بازنشانی
                  </button>
                </div>
                <label class="login-social-icon"
                  ><span
                    ><a
                      class="text-primary ms-1"
                      href="<%=process.env.SITEURL%>/panel/login"
                    >
                      بازگشت به صفحه ورود</a
                    ></span
                  ></label
                >
              </form>
            </div>
          </div>
        </div>
      </div>
      <!--END PAGE -->
    </div>
    <!-- BACKGROUND-IMAGE CLOSED -->

    <!-- JQUERY JS -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/js/toast/toastify.js"></script>
    <script src="/js/toast/toast.js"></script>

    <!-- BOOTSTRAP JS -->
    <script src="/assets/plugins/bootstrap/js/popper.min.js"></script>
    <script src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>

    <!-- SHOW PASSWORD JS -->
    <script src="/assets/js/show-password.min.js"></script>

    <!-- Perfect SCROLLBAR JS-->
    <script src="/assets/plugins/p-scroll/perfect-scrollbar.js"></script>

    <!-- Color Theme js -->
    <script src="/assets/js/themeColors.js"></script>

    <!-- CUSTOM JS -->
    <script src="/assets/js/custom.js"></script>

    <script src="/assets/js/custom1.js"></script>

    <!-- Switcher js -->
    <script src="/assets/switcher/js/switcher.js"></script>
    <script>
      $(document).ready(function () {
        let siteUrl = `<%=process.env.SITEURL%>`;
        let token = `<%=token%>`;
        $("#resetPassword").on("click", (e) => {
          e.preventDefault();
          $("#sendForgetEmail").prop("disabled", true);
          $("#sendForgetEmail span").removeClass("visually-hidden");
          let email = $("#forgetEmail").val();
          let password = $("#password").val();
          let rePassword = $("#rePassword").val();
          if(password != rePassword){
            Toast('گذرواژه و تکرار آن مطابقت ندارند.', "error", false);
            return;
          }
          let data = {
            token,
            email,
            password,
            rePassword,
          };
          data = JSON.stringify(data);
          $.ajax({
            url: `${siteUrl}/resetPassword`,
            type: "post",
            dataType: "json",
            async:true,
            contentType: "application/json",
            data,
            success: (res) => {
              console.log(res);
              Toast(res.message, "success", false);
              $("#resetPassword").prop("disabled", false);
              $("#resetPassword span").addClass("visually-hidden");
              setTimeout(()=>{
                  window.location.href = `${window.location.origin}`;
              },800);
            },
            error: function (err) {
              $("#resetPassword").prop("disabled", false);
              $("#resetPassword span").addClass("visually-hidden");
              console.log(err);
              Toast(err.responseJSON.message, "error", false);
            },
          });
        });
      });
    </script>
  </body>
</html>
